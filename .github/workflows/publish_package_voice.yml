name: Publish Package Voice

on:
  push:
    branches: main
    paths:
      - 'Voice/pyproject.toml'

jobs:
  observe:
    runs-on: ubuntu-latest
    steps:
      - uses: plengauer/opentelemetry-bash/actions/instrument/workflow@v4.10.2
        env:
          OTEL_EXPORTER_OTLP_METRICS_ENDPOINT: 'http://${{ secrets.PARENT_DOMAIN }}:4318/v1/metrics'
          OTEL_EXPORTER_OTLP_LOGS_ENDPOINT: 'http://${{ secrets.PARENT_DOMAIN }}:4318/v1/logs'
          OTEL_EXPORTER_OTLP_TRACES_ENDPOINT: 'http://${{ secrets.PARENT_DOMAIN }}:4318/v1/traces'

  publish-pypi:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./Voice/
    steps:
      - uses: plengauer/opentelemetry-bash/actions/instrument/job@v4.10.2
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - run: |
          python -m pip install --upgrade pip
          pip install twine
          pip install build
      - run: python -m build
      - run: twine upload --username __token__ ./dist/*
        env:
          TWINE_PASSWORD: ${{secrets.PYPI_PASSWORD}}
